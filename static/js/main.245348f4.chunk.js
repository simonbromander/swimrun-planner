(this["webpackJsonpmy-swimrun-app"]=this["webpackJsonpmy-swimrun-app"]||[]).push([[0],{22:function(t){t.exports=JSON.parse('{"type":"FeatureCollection","features":[{"type":"Feature","properties":{},"geometry":{"type":"Polygon","coordinates":[[[-180,-90],[180,-90],[180,90],[-180,90],[-180,-90]]]}}]}')},23:function(t){t.exports=JSON.parse('{"type":"FeatureCollection","features":[{"type":"Feature","properties":{},"geometry":{"type":"Polygon","coordinates":[[[-180,-90],[180,-90],[180,90],[-180,90],[-180,-90]]]}}]}')},29:function(t,e,n){},36:function(t,e,n){},37:function(t,e,n){},39:function(t,e,n){"use strict";n.r(e);var s=n(0),o=n.n(s),a=n(9),i=n.n(a),r=(n(29),n(42)),l=n(44),c=n(41),u=n(40),d=n(43),h=(n(18),n(2)),p=n.n(h),g=n(24),b=n(1);var j=o.a.forwardRef(((t,e)=>{let{markers:n,route:o,onMapClick:a,onMarkerClick:i,handleFindLocation:h,onMarkerDragEnd:j}=t;Object(s.useEffect)((()=>{console.log("MapComponent mounted"),console.log("Markers: ",n),console.log("Route: ",o)}),[n,o]);const m=t=>{let e,n;return"start"===t?(e="\ud83d\udfe2",n="rgba(0, 128, 0, 0.5)"):"swim"===t?(e="\ud83c\udfca",n="rgba(0, 0, 255, 0.5)"):"run"===t?(e="\ud83c\udfc3",n="rgba(255, 165, 0, 0.5)"):"stop"===t&&(e="\ud83c\udfc1",n="rgba(0, 0, 0, 0.5)"),new p.a.DivIcon({html:'<div style="background-color: '.concat(n,'; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;"><span style="font-size: 24px;">').concat(e,"</span></div>"),className:""})};return Object(b.jsxs)(r.a,{center:[51.505,-.09],zoom:13,style:{height:"100%",width:"100%"},ref:e,onClick:a,children:[Object(b.jsx)(l.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),Object(b.jsx)(c.a,{position:"bottomleft"}),Object(b.jsx)(g.a,{position:"topright"}),n.map(((t,e)=>Object(b.jsx)(u.a,{position:[t.lat,t.lng],icon:m(t.type),draggable:!0,eventHandlers:{click:()=>i(e),dragend:t=>{const{lat:n,lng:s}=t.target.getLatLng();j(e,n,s)}}},e))),(()=>{const t=[];for(let n=0;n<o.length-1;n++)t.push({positions:[[o[n].lat,o[n].lng],[o[n+1].lat,o[n+1].lng]],color:(e=o[n].type,"swim"===e?"#2980b9":"#e67e22")});var e;return t})().map(((t,e)=>Object(b.jsx)(d.a,{positions:t.positions,color:t.color},e))),Object(b.jsx)("div",{className:"find-location-btn",onClick:h,children:"\ud83d\udccd"})]})}));n(36);const m=t=>{let{onFindLocation:e,setMode:n,distances:s,currentPolylineDistance:o,lastPointDistance:a,clearRoute:i,undoLastPoint:r}=t;return Object(b.jsxs)("div",{className:"button-panel",children:[Object(b.jsxs)("div",{className:"button-row",children:[Object(b.jsx)("button",{className:"button-highlight",onClick:()=>n("swim"),children:"\ud83c\udfca Start Swim"}),Object(b.jsx)("button",{className:"button-highlight",onClick:()=>n("run"),children:"\ud83c\udfc3 Start Run"}),Object(b.jsx)("button",{className:"button-secondary",onClick:()=>n("stop"),children:"\ud83c\udfc1 Stop Route"})]}),Object(b.jsxs)("div",{className:"button-row",children:[Object(b.jsx)("button",{className:"button-primary",onClick:e,children:"\ud83d\udccd Find my location"}),Object(b.jsx)("button",{className:"button-secondary",onClick:i,children:"\ud83d\uddd1\ufe0f Clear Route"}),Object(b.jsx)("button",{className:"button-secondary",onClick:r,children:"\u21a9\ufe0f Undo"})]}),Object(b.jsxs)("div",{className:"distances",children:[Object(b.jsxs)("p",{children:["Swim: ",Object(b.jsxs)("span",{className:"distance-highlight",children:[s.swim.toFixed(2)," km"]})]}),Object(b.jsxs)("p",{children:["Run: ",Object(b.jsxs)("span",{className:"distance-highlight",children:[s.run.toFixed(2)," km"]})]}),Object(b.jsxs)("p",{children:["Total: ",Object(b.jsxs)("span",{className:"distance-highlight",children:[o.toFixed(2)," km"]})]}),Object(b.jsxs)("p",{children:["Last added: ",Object(b.jsxs)("span",{className:"distance-highlight",children:[a.toFixed(2)," km"]})]})]})]})};m.defaultProps={onFindLocation:()=>{}};var x=m,y=(n(37),n(11)),f=n(22),O=n(23);var w=function(){const t=o.a.useRef(),[e,n]=o.a.useState(null),[s,a]=o.a.useState([]),[i,r]=o.a.useState([]),[l,c]=o.a.useState({swim:0,run:0}),[u,d]=o.a.useState(0),[h,p]=o.a.useState(0),[g,m]=o.a.useState(null),w=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{const{latitude:n,longitude:s}=e.coords;t.current?t.current.setView([n,s],13):console.error("Map reference is not available")})):alert("Geolocation is not supported by this browser.")},k=(t,e)=>{const n=y.point([e,t]);for(const s of f.features)if(y.booleanPointInPolygon(n,s))return!0;return!1},M=(t,e)=>{const n=y.point([e,t]);for(const s of O.features)if(y.booleanPointInPolygon(n,s))return!0;return!1},N=t=>{if(i.length>0){const e=i[i.length-1],n=v(e.lat,e.lng,t.lat,t.lng);d((t=>t+n)),p(n),"swim"===t.type?c((t=>({...t,swim:t.swim+n}))):"run"===t.type&&c((t=>({...t,run:t.run+n})))}},v=(t,e,n,s)=>{const o=(n-t)*Math.PI/180,a=(s-e)*Math.PI/180,i=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))},P=()=>{a([]),r([]),c({swim:0,run:0}),d(0),p(0)},C=t=>{let e=0,n=0,s=0;for(let o=0;o<t.length-1;o++){const a=v(t[o].lat,t[o].lng,t[o+1].lat,t[o+1].lng);s+=a,"swim"===t[o].type?e+=a:"run"===t[o].type&&(n+=a)}c({swim:e,run:n}),d(s),t.length>1&&p(v(t[t.length-2].lat,t[t.length-2].lng,t[t.length-1].lat,t[t.length-1].lng))};return Object(b.jsxs)("div",{className:"App",children:[Object(b.jsx)("div",{className:"map-container",children:Object(b.jsx)(j,{ref:t,markers:s,route:i,onMapClick:t=>{const{lat:n,lng:o}=t.latlng,l={lat:n,lng:o,type:e};if(i.length>0){const t=i[i.length-1],e=((t,e,n,s)=>{const o=k(t,e),a=k(n,s);if(o&&a)return"run";const i=M(t,e),r=M(n,s);return i&&r?"swim":"unknown"})(t.lat,t.lng,n,o);l.type=e}if(null!==g){const t=[...s],e=[...i];t[g]=l,e[g]=l,a(t),r(e),m(null)}else 0===i.length?(a([{...l,type:"start"},l]),r([l])):(a([...s,l]),r([...i,l])),N(l)},onMarkerClick:t=>{m(t)},handleFindLocation:w,onMarkerDragEnd:(t,e,n)=>{const o=[...s],l=[...i];o[t]={...o[t],lat:e,lng:n},l[t]={...l[t],lat:e,lng:n},a(o),r(l),C(l)}})}),Object(b.jsx)(x,{setMode:n,clearRoute:P,distances:l,currentPolylineDistance:u,lastPointDistance:h,onFindLocation:w,undoLastPoint:()=>{if(s.length>1){const t=s.slice(0,-1),e=i.slice(0,-1),n=s[s.length-1],o=s[s.length-2],l=v(o.lat,o.lng,n.lat,n.lng);a(t),r(e),"swim"===n.type?c((t=>({...t,swim:t.swim-l}))):"run"===n.type&&c((t=>({...t,run:t.run-l}))),d((t=>t-l)),p(0)}else P()}})]})};i.a.render(Object(b.jsx)(o.a.StrictMode,{children:Object(b.jsx)(w,{})}),document.getElementById("root"))}},[[39,1,2]]]);
//# sourceMappingURL=main.245348f4.chunk.js.map