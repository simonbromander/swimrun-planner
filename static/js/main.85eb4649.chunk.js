(this["webpackJsonpmy-swimrun-app"]=this["webpackJsonpmy-swimrun-app"]||[]).push([[0],{26:function(t,e,n){},33:function(t,e,n){},34:function(t,e,n){},35:function(t,e,n){"use strict";n.r(e);var s=n(0),a=n.n(s),o=n(9),i=n.n(o),c=(n(26),n(38)),l=n(40),r=n(37),h=n(36),d=n(39),u=(n(17),n(2)),g=n.n(u),p=n(21),j=n(1);var b=a.a.forwardRef(((t,e)=>{let{markers:n,route:a,onMapClick:o,onMarkerClick:i,handleFindLocation:u,onMarkerDragEnd:b}=t;Object(s.useEffect)((()=>{console.log("MapComponent mounted"),console.log("Markers: ",n),console.log("Route: ",a)}),[n,a]);const m=t=>{let e,n;return"start"===t?(e="\ud83d\udfe2",n="rgba(0, 128, 0, 0.5)"):"swim"===t?(e="\ud83c\udfca",n="rgba(0, 0, 255, 0.5)"):"run"===t?(e="\ud83c\udfc3",n="rgba(255, 165, 0, 0.5)"):"stop"===t&&(e="\ud83c\udfc1",n="rgba(0, 0, 0, 0.5)"),new g.a.DivIcon({html:'<div style="background-color: '.concat(n,'; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;"><span style="font-size: 24px;">').concat(e,"</span></div>"),className:""})};return Object(j.jsxs)(c.a,{center:[51.505,-.09],zoom:13,style:{height:"100%",width:"100%"},ref:e,onClick:o,children:[Object(j.jsx)(l.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),Object(j.jsx)(r.a,{position:"bottomleft"}),Object(j.jsx)(p.a,{position:"topright"}),n.map(((t,e)=>Object(j.jsx)(h.a,{position:[t.lat,t.lng],icon:m(t.type),draggable:!0,eventHandlers:{click:()=>i(e),dragend:t=>{const{lat:n,lng:s}=t.target.getLatLng();b(e,n,s)}}},e))),(()=>{const t=[];for(let n=0;n<a.length-1;n++)t.push({positions:[[a[n].lat,a[n].lng],[a[n+1].lat,a[n+1].lng]],color:(e=a[n].type,"swim"===e?"#2980b9":"#e67e22")});var e;return t})().map(((t,e)=>Object(j.jsx)(d.a,{positions:t.positions,color:t.color},e))),Object(j.jsx)("div",{className:"find-location-btn",onClick:u,children:"\ud83d\udccd"})]})}));n(33);const m=t=>{let{onFindLocation:e,setMode:n,distances:s,currentPolylineDistance:a,lastPointDistance:o,clearRoute:i}=t;return Object(j.jsxs)("div",{className:"button-panel",children:[Object(j.jsxs)("div",{className:"button-row",children:[Object(j.jsx)("button",{className:"button-highlight",onClick:()=>n("swim"),children:"\ud83c\udfca Start Swim"}),Object(j.jsx)("button",{className:"button-highlight",onClick:()=>n("run"),children:"\ud83c\udfc3 Start Run"}),Object(j.jsx)("button",{className:"button-secondary",onClick:()=>n("stop"),children:"\ud83c\udfc1 Stop Route"})]}),Object(j.jsxs)("div",{className:"button-row",children:[Object(j.jsx)("button",{className:"button-primary",onClick:e,children:"\ud83d\udccd Find my location"}),Object(j.jsx)("button",{className:"button-secondary",onClick:i,children:"\ud83d\uddd1\ufe0f Clear Route"})]}),Object(j.jsxs)("div",{className:"distances",children:[Object(j.jsxs)("p",{children:["Swim: ",Object(j.jsxs)("span",{className:"distance-highlight",children:[s.swim.toFixed(2)," km"]})]}),Object(j.jsxs)("p",{children:["Run: ",Object(j.jsxs)("span",{className:"distance-highlight",children:[s.run.toFixed(2)," km"]})]}),Object(j.jsxs)("p",{children:["Total: ",Object(j.jsxs)("span",{className:"distance-highlight",children:[a.toFixed(2)," km"]})]}),Object(j.jsxs)("p",{children:["Last added: ",Object(j.jsxs)("span",{className:"distance-highlight",children:[o.toFixed(2)," km"]})]})]})]})};m.defaultProps={onFindLocation:()=>{}};var x=m;n(34);var O=function(){const t=a.a.useRef(),[e,n]=a.a.useState(null),[s,o]=a.a.useState([]),[i,c]=a.a.useState([]),[l,r]=a.a.useState({swim:0,run:0}),[h,d]=a.a.useState(0),[u,g]=a.a.useState(0),[p,m]=a.a.useState(null),O=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{const{latitude:n,longitude:s}=e.coords;t.current?t.current.setView([n,s],13):console.error("Map reference is not available")})):alert("Geolocation is not supported by this browser.")},w=t=>{if(i.length>0){const n=i[i.length-1],s=k(n.lat,n.lng,t.lat,t.lng);d((t=>t+s)),g(s),"swim"===e?r((t=>({...t,swim:t.swim+s}))):"run"===e&&r((t=>({...t,run:t.run+s})))}},k=(t,e,n,s)=>{const a=(n-t)*Math.PI/180,o=(s-e)*Math.PI/180,i=Math.sin(a/2)*Math.sin(a/2)+Math.cos(t*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(o/2)*Math.sin(o/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))},M=t=>{let e=0,n=0,s=0;for(let a=0;a<t.length-1;a++){const o=k(t[a].lat,t[a].lng,t[a+1].lat,t[a+1].lng);s+=o,"swim"===t[a].type?e+=o:"run"===t[a].type&&(n+=o)}r({swim:e,run:n}),d(s),t.length>1&&g(k(t[t.length-2].lat,t[t.length-2].lng,t[t.length-1].lat,t[t.length-1].lng))};return Object(j.jsxs)("div",{className:"App",children:[Object(j.jsx)("div",{className:"map-container",children:Object(j.jsx)(b,{ref:t,markers:s,route:i,onMapClick:t=>{const{lat:n,lng:a}=t.latlng,l={lat:n,lng:a,type:e};if(null!==p){const t=[...s],e=[...i];t[p]=l,e[p]=l,o(t),c(e),m(null)}else"stop"===e?(o([...s,l]),c([...i,l]),d(0),g(0)):"swim"!==e&&"run"!==e||(0===i.length?(o([{...l,type:"start"},l]),c([l])):(o([...s,l]),c([...i,l])),w(l))},onMarkerClick:t=>{m(t)},handleFindLocation:O,onMarkerDragEnd:(t,e,n)=>{const a=[...s],l=[...i];a[t]={...a[t],lat:e,lng:n},l[t]={...l[t],lat:e,lng:n},o(a),c(l),M(l)}})}),Object(j.jsx)(x,{setMode:n,clearRoute:()=>{o([]),c([]),r({swim:0,run:0}),d(0),g(0)},distances:l,currentPolylineDistance:h,lastPointDistance:u,onFindLocation:O})]})};i.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(O,{})}),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.85eb4649.chunk.js.map